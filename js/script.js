const menuBtns=document.querySelectorAll(".js-toggleMenu");menuBtns?.forEach((e=>{e.addEventListener("click",(e=>{const t=e.currentTarget.dataset?.menu;document.getElementById(t)?.classList.toggle("menu--visible")}))}));const mediaQueryList=window.matchMedia("(min-width: 768px)");mediaQueryList.addEventListener("change",(e=>{const t=document.querySelector(".menu--visible");e.matches&&t?.classList.remove("menu--visible")}));const mainSlider=document.querySelector(".swiper-main-slider");if(mainSlider){new Swiper(".swiper-main-slider",{initialSlide:Number(localStorage.getItem("activeSlide"))||0,on:{activeIndexChange:function(){localStorage.setItem("activeSlide",this.realIndex)}},pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}const porfolioSlider=document.querySelector(".swiper-portfolio-slider");if(porfolioSlider){new Swiper(".swiper-portfolio-slider",{navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"}})}const modalBtns=document.querySelectorAll(".js-toggleModal");modalBtns?.forEach((e=>{e.addEventListener("click",(e=>{e.preventDefault();const t=e.currentTarget.dataset?.modal;document.getElementById(t)?.classList.toggle("modal--is-open")}))})),document.addEventListener("keydown",(e=>{if("Escape"===e.key){document.querySelector(".modal--is-open")?.classList.remove("modal--is-open")}}));const scrollBtn=document.querySelector(".js-scrollToUpBtn");window.addEventListener("scroll",(()=>{scrollBtn?.classList.toggle("scroll-btn-up--is-active",window.scrollY>1e3)})),scrollBtn?.addEventListener("click",(()=>{window.scrollTo({top:0,behavior:"smooth"})}));const forms=document.querySelectorAll(".js-contactForm"),formMsgClassNames={msg:"contacts-form__message",errorMsg:"contacts-form__message--error",rightMsg:"contacts-form__message--right"},formMsg=formMsgClassNames.msg,error=formMsgClassNames.errorMsg,right=formMsgClassNames.rightMsg,fieldClassNames={error:"custom-form-field--error",right:"custom-form-field--right"},errorField=fieldClassNames.error,rightField=fieldClassNames.right,messages={right:"All right",empty:"This field is required",email:'Please enter a valid email address (your entry is not in the format "somebody@example.com" or "somebody@local")',password:{isFalse:"Your password must contain letters and numbers",repeat:"Passwords do not match. Please check the identity of the passwords in both fields"},phone:'Please enter a valid phone number (your entry is not in the format "+7 977 777 77 77")',age:"Please enter a correct age"},regExp={email:/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,phone:/^(\s*)?(\+)?([-_():=+]?\d[- _():=+]?){10,14}(\s*)?$/,password:/^[0-9a-z]+/i};let errorsCounter=0;function delElement(e,t){e.querySelectorAll(".contacts-form__message, .contacts-form__message--error, .contacts-form__message--right")?.forEach((e=>{e.remove()})),t?.forEach((e=>{e.classList.remove("custom-form-field--error","custom-form-field--right")})),errorsCounter=0}function validateField(e,t,o){const r=document.createElement("span");r.className=`${formMsg} ${t}`,r.innerText=o,e?.parentElement?.insertAdjacentElement("beforeend",r),t===error?(e?.classList.add(errorField),errorsCounter+=1):t===right&&e?.classList.add(rightField)}forms?.forEach((e=>{e.noValidate=!0;const t=e.querySelectorAll(".js-validFormField");e.querySelectorAll(".js-approvedCheckbox")?.forEach((t=>{t.addEventListener("click",(()=>{const o=e.querySelector(".js-submitBtn");t.checked?o?.removeAttribute("disabled"):o?.setAttribute("disabled",!0)}))})),e.addEventListener("submit",(o=>{o.preventDefault(),delElement(e),t?.forEach((t=>{const o={validEmail:regExp.email.test(t.value),validPhone:regExp.phone.test(t.value),validPassword:regExp.password.test(t.value)};function r(e,o){t.value?!1===e?validateField(t,error,o):validateField(t,right,messages.right):validateField(t,error,messages.empty)}switch(t.type){case"email":r(o.validEmail,messages.email);break;case"password":if("password"===t.name||"oldPassword"===t.name||"newPassword"===t.name)r(o.validPassword,messages.password.isFalse);else if("password-repeat"===t.name||"newPasswordRepeat"===t.name){const o=e.querySelector(".password"),r=e.querySelector(".password-repeat");t.value?r?.value!==o?.value&&""!==r?.value?validateField(t,error,messages.password.repeat):r?.value===o?.value&&""!==r?.value&&validateField(t,right,messages.right):validateField(t,error,messages.empty)}break;case"tel":r(o.validPhone,messages.phone);break;case"number":"age"===t.name&&(t.value?!1==(s=t.value,!(isNaN(s)||""===s||s<=0))?validateField(t,error,messages.age):validateField(t,right,messages.right):validateField(t,error,messages.empty));break;default:r()}var s}))}))}));const BASE_URL="https://academy.directlinedev.com",loaderTitle={load:"Loading",send:"Sending"},loader=loaderTitle.load,sender=loaderTitle.send;function toggleLoader(e){const t=document.querySelector(".js-preloader");setTitleToLoader(t,e),t?.classList.toggle("preloader--is-hidden")}function setTitleToLoader(e,t){if(e){const o=e?.querySelector(".js-setPreloaderTitle");o.innerText=t}}const registerForm=document.forms.registerForm,registerModal=document.getElementById("registerModal"),onSuccessModal=document.querySelector(".js-toggleModalSuccessfully"),onErrorModal=document.querySelector(".js-toggleModalError");function interactionModal(e){e?.classList.toggle("modal--is-open")}function scheduleCall(e){setTimeout((()=>{interactionModal(e)}),2e3)}function sendData({url:e,method:t,headers:o,body:r}){return fetch(`${BASE_URL}/${e}`,{method:t,body:r,headers:o})}function register(e){e.preventDefault();const t=formFieldProcessing({form:registerForm});sendData({url:"api/users",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if(!e.success)throw e;toggleLoader(sender),interactionModal(registerModal),interactionModal(onSuccessModal),scheduleCall(onSuccessModal)})).catch(((e,t)=>{e.errors?(toggleLoader(sender),errorHandler(e.errors,registerForm)):(errorModalHandler({response:t}),toggleLoader(sender),interactionModal(onErrorModal),scheduleCall(onErrorModal))}))}function errorModalHandler({response:e},t){const o=onErrorModal?.querySelector(".modal__title");o.innerText=e?`The form was sent but the server transmits an error: ${e.status} ${e.statusText}`:t?`The form was sent but the server transmits an error "${t}"`:"The form was sent but the server transmits an error"}function errorHandler(e,t){if(Object.keys(e).length){const o=t.querySelectorAll(".js-validFormField");delElement(t,o),Object.keys(e).forEach((o=>{const r=e[o];validateField(t.elements[o],error,r)}))}}function formFieldProcessing({form:e,type:t="json"}){switch(t){case"json":{const t=e.querySelectorAll(".custom-form-field");switch(e){case registerForm:{const e={};return t.forEach((t=>{e[t.name]=t.value})),e}case sendMsgForm:{const o={};o.to=e.to.value;const r={};return t.forEach((e=>{"to"!==e.name&&(r[e.name]=e.value)})),o.body=JSON.stringify(r),o}default:{const e={};return t.forEach((t=>{e[t.name]=t.value})),e}}break}case"formData":return new FormData(e);default:return"Вы передали неверные данные!"}}function serializeForm(e){const{elements:t}=e;Array.from(t).filter((e=>!!e.name)).map((e=>{const{name:t,value:o}=e;return{name:t,value:o}}))}registerForm?.addEventListener("submit",(e=>{e.preventDefault(),0===errorsCounter&&(serializeForm(registerForm),toggleLoader(sender),register(e))}));const sendMsgForm=document.forms.sendMsgForm,sendMsgModal=document.getElementById("sendMsgModal");function sendMsg(e){e.preventDefault();const t=formFieldProcessing({form:sendMsgForm});sendData({url:"api/emails",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if(!e.success)throw e;toggleLoader(sender),interactionModal(sendMsgModal),interactionModal(onSuccessModal),scheduleCall(onSuccessModal)})).catch(((e,t)=>{e.errors?(toggleLoader(sender),errorHandler(e.errors,sendMsgForm)):(errorModalHandler({response:t}),toggleLoader(sender),interactionModal(onErrorModal),scheduleCall(onErrorModal))}))}sendMsgForm?.addEventListener("submit",(e=>{e.preventDefault(),0===errorsCounter&&(serializeForm(sendMsgForm),toggleLoader(sender),sendMsg(e))}));const signInForm=document.forms.signInForm,signInModal=document.getElementById("signInModal"),menuItems=document.querySelectorAll(".js-toggleMenuItem");function updateToken(){toggleMenuItems(localStorage.getItem("token"))}function toggleMenuItems(e){e&&menuItems?.forEach((e=>e.classList.toggle("u-hidden")))}function signIn(e){e.preventDefault();const t=formFieldProcessing({form:signInForm});sendData({url:"api/users/login",method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((e=>{if(!e.success)throw e;localStorage.setItem("token",e.data.token),localStorage.setItem("userId",e.data.userId),interactionModal(signInModal),toggleLoader(sender),updateToken()})).catch(((e,t)=>{if(e._message){toggleLoader(sender);errorHandler({email:e._message},signInForm)}else errorModalHandler({response:t}),toggleLoader(sender),interactionModal(onErrorModal),scheduleCall(onErrorModal)}))}if(updateToken(),signInForm?.addEventListener("submit",(e=>{e.preventDefault(),0===errorsCounter&&(serializeForm(signInForm),toggleLoader(sender),signIn(e))})),"/profile.html"===location.pathname){let e={};function getProfileData(){sendData({url:`api/users/${localStorage.getItem("userId")}`,method:"GET",headers:{"Content-Type":"application/json","x-access-token":localStorage.getItem("token")}}).then((e=>e.json())).then((t=>{t.success?(e=t.data,setProfileData(e),toggleLoader(loader)):location.pathname="/"})).catch((e=>{console.error(e),interactionModal(onErrorModal),toggleLoader(loader)}))}function setProfileData({photoUrl:e,name:t,surname:o,email:r,password:s,location:a,age:n}){const l=document.querySelector(".profile__content")?.querySelectorAll(".js-setProfileData");l?.forEach((l=>{switch(l.dataset.profile){case"photoUrl":l.src=`${BASE_URL}${e}`;break;case"name":l.innerText=t;break;case"surname":l.innerText=o;break;case"email":l.innerText=r;break;case"password":l.innerText=s.replaceAll(/./gm,"*");break;case"location":l.innerText=a;break;case"age":l.innerText=n;break;default:l.innerText=""}}))}toggleLoader(loader),getProfileData();const t=document.forms.changePasswordForm,o=document.getElementById("changePasswordModal");function removeItemsFromStorage(){localStorage.removeItem("token"),localStorage.removeItem("userId"),location.pathname="/"}function changePassword(e){e.preventDefault();sendData({url:"api/users",method:"PUT",body:formFieldProcessing({form:t,type:"formData"}),headers:{"x-access-token":localStorage.getItem("token")}}).then((e=>{if(401!==e.status&&403!==e.status)return e.json();removeItemsFromStorage()})).then((e=>{if(!e.success)throw e;getProfileData(),interactionModal(o),interactionModal(onSuccessModal),scheduleCall(onSuccessModal)})).catch(((e,o)=>{if(e.errors)toggleLoader(sender),errorHandler(e.errors,t);else if(e._message)toggleLoader(sender),errorHandler(e._message,t);else{const e="Check the correctness of the entered data";toggleLoader(sender),errorModalHandler({response:o},e),interactionModal(onErrorModal),scheduleCall(onErrorModal)}}))}t?.addEventListener("submit",(e=>{e.preventDefault(),0===errorsCounter&&(serializeForm(t),toggleLoader(sender),changePassword(e))}));const r=document.forms.changeDataForm,s=document.getElementById("changeDataModal");function setFormValuesFromProfileData(e,{email:t,name:o,surname:r,location:s,age:a}){e.email.value=t,e.name.value=o,e.surname.value=r,e.location.value=s,e.age.value=a}function changeData(e){e.preventDefault();sendData({url:"api/users",method:"PUT",body:formFieldProcessing({form:r,type:"formData"}),headers:{"x-access-token":localStorage.getItem("token")}}).then((e=>{if(401!==e.status&&403!==e.status)return e.json();removeItemsFromStorage()})).then((e=>{if(!e.success)throw e;getProfileData(),interactionModal(s),interactionModal(onSuccessModal),scheduleCall(onSuccessModal)})).catch(((e,t)=>{if(e.errors)toggleLoader(sender),errorHandler(e.errors,r);else if(e._message)toggleLoader(sender),errorHandler(e._message,r);else{const e="Check the correctness of the entered data";toggleLoader(sender),errorModalHandler({response:t},e),interactionModal(onErrorModal),scheduleCall(onErrorModal)}}))}document.querySelector(".js-setProfileDataToForm")?.addEventListener("click",(()=>{setFormValuesFromProfileData(r,e)})),r?.addEventListener("submit",(e=>{e.preventDefault(),toggleLoader(sender),changeData(e)}));function deleteAccount(){sendData({url:`api/users/${localStorage.getItem("userId")}`,method:"DELETE",headers:{"x-access-token":localStorage.getItem("token")}}).then((e=>{if(401!==e.status&&403!==e.status)return e.json();removeItemsFromStorage()})).then((e=>{if(e.success)return interactionModal(onSuccessModal),void removeItemsFromStorage();throw e})).catch((e=>{errorModalHandler({response:e}),interactionModal(onErrorModal)}))}document.forms.deleteAccountForm?.addEventListener("submit",(e=>{e.preventDefault(),deleteAccount()}));document.querySelector(".js-signOut").addEventListener("click",(()=>{removeItemsFromStorage()}))}const passwordInputs=document.querySelectorAll(".js-showPasswordViewBtn");passwordInputs.forEach((e=>{e.addEventListener("input",(t=>{const o=t.currentTarget.id,r=document.querySelector(`[data-password="${o}"`);e.value.length?r?.classList.remove("u-hidden"):r?.classList.add("u-hidden")}))}));const passwordViewBtn=document.querySelectorAll(".js-togglePasswordView");function togglePasswordView(e){e.target.classList.toggle("contacts-form__password-control-btn--view");const t=e.currentTarget.dataset.password,o=document.getElementById(t);"password"===o?.getAttribute("type")?o?.setAttribute("type","text"):o?.setAttribute("type","password")}passwordViewBtn?.forEach((e=>{e?.addEventListener("click",togglePasswordView)}));const fileInputs=document.querySelectorAll(".js-setFileName");fileInputs?.forEach((e=>{e.addEventListener("change",(t=>{const o=e.files[0]?.name;document.querySelector(".custom-file__name").innerText=function(e){if(!e){return"File is not chosen!"}}(o)||function(e){if(e.length>20){return`${e.slice(0,15)}...${e.split(".").pop()}`}return e}(o)}))})),"/blog.html"===location.pathname&&function(){function e(){let e=new URLSearchParams(location.search);return{page:Number(e.get("page"))||0,comments:e.getAll("comments"),views:e.get("views"),sortBy:e.get("sortBy"),howShow:e.get("howShow"),tags:e.getAll("tags"),search:e.get("search")||""}}const t=document.forms.filter;t?.addEventListener("submit",(e=>{e.preventDefault();let o={page:0};o.search=t.elements.search.value,o.tags=[...t.elements.tags].filter((e=>e.checked)).map((e=>e.value)),o.views=([...t.elements.views].find((e=>e.checked))||{value:null}).value,o.comments=[...t.elements.comments].filter((e=>e.checked)).map((e=>e.value)),o.howShow=([...t.elements.howShow].find((e=>e.checked))||{value:null}).value,o.sortBy=([...t.elements.sortBy].find((e=>e.checked))||{value:null}).value,a(o),function(e){let t=new URLSearchParams;e.page?t.set("page",e.page):t.set("page",0),e.comments?.forEach((e=>{t.append("comments",e)})),e.views&&t.set("views",e.views),e.sortBy&&t.set("sortBy",e.sortBy),e.howShow&&t.set("howShow",e.howShow),e.tags?.forEach((e=>{t.append("tags",e)})),t.set("search",e.search),history.replaceState(null,document.title,"?"+t.toString()),localStorage.setItem("searchParams",t.toString())}(o)}));const o=({method:e,url:t,searchParams:o,headers:r,body:s=null,onload:a,onerror:n})=>{const l=new XMLHttpRequest;toggleLoader(loader),l.open(e,`${BASE_URL}/${t}?${o}`),r&&l.setRequestHeader(r.key,r.value),l.send(s),l.onload=()=>a({xhr:l}),l.onerror=()=>n()};function r(t){const o=document.querySelectorAll(".blog-pagination__link");let r=new URLSearchParams(location.search);o[e().page].classList.remove("blog-pagination__link--current"),r.set("page",t),o[t].classList.add("blog-pagination__link--current"),history.replaceState(null,document.title,"?"+r.toString()),a(e())}o({method:"GET",url:"api/tags",onload:({xhr:t})=>{if(200===t.status){const o=JSON.parse(t.response).data,r=document.querySelector(".blog-filters__list--tags");toggleLoader(loader),o.forEach((e=>{const t=function({id:e,color:t,name:o}){return`\n                <li class="blog-filters__item blog-filters__item--tag">\n                    <input class="custom-checkbox custom-checkbox--tag"\n                        type="checkbox"\n                        id="color-${e}"\n                        name="tags"\n                        value="${e}">\n                    <label for="color-${e}"\n                        style="--bg-color: ${t}">\n                        <span class="visually-hidden">${o}</span>\n                    </label>\n                </li>\n            `}(e);r?.insertAdjacentHTML("beforeend",t)})),!location.search.length&&localStorage.getItem("searchParams")&&(location.search=localStorage.getItem("searchParams"));let s=e();!function(e){const t=document.forms.filter;t?.elements.comments?.forEach((t=>{e.comments.includes(t.value)&&(t.checked=!0)})),t?.elements.views?.forEach((t=>{e.views===t.value&&(t.checked=!0)})),t?.elements.sortBy?.forEach((t=>{e.sortBy===t.value&&(t.checked=!0)})),t?.elements.howShow?.forEach((t=>{e.howShow===t.value&&(t.checked=!0)})),t?.elements.tags?.forEach((t=>{e.tags.includes(t.value)&&(t.checked=!0)})),t&&(t.elements.search.value=e.search)}(s),a(s)}else alert(`Ошибка ${t.status}: ${t.statusText}`)},onerror:()=>{toggleLoader(loader),console.error("The data has arrived with error")}});const s=document.querySelectorAll(".js-paginationBtn");s.forEach((t=>{t?.addEventListener("click",(t=>{const o=t.currentTarget.dataset.direction;let s=e();r("left"===o?s.page-1:s.page+1)}))}));function a(t){let r=new URLSearchParams;r.set("v","1.0.0"),t.tags&&Array.isArray(t.tags)&&t.tags.length&&r.set("tags",JSON.stringify(t.tags));let a={};t.search&&(a.title=t.search);let l=5;if(Number(t.howShow)&&(l=Number(t.howShow)),r.set("limit",l),t.views){const e=t.views.split("-");a.views={$between:e}}if(t.comments.length){const e=[t.comments[0].split("-")[0],t.comments[t.comments.length-1].split("-")[1]];a.commentsCount={$between:e}}r.set("filter",JSON.stringify(a)),Number(t.page)&&r.set("offset",Number(t.page)*l),t.sortBy&&r.set("sort",JSON.stringify([t.sortBy,"ASC"]));const i=r.toString();o({method:"GET",url:"api/posts",searchParams:`${i}`,onload:({xhr:t})=>{if(200===t.status){const o=JSON.parse(t.response),r=o.data;toggleLoader(loader);let a="";r.forEach((e=>{a+=function({title:e,text:t,tags:o,date:r,views:s,commentsCount:a,photo:n}){const l=o.map((e=>`<span class="blog-article__tags-item" style="background-color: ${e.color}"></span>`)).join(""),i=new Date(r),c=i.getDate()<10?`0${i.getDate()}`:i.getDate(),d=i.getMonth()<10?`0${i.getMonth()+1}`:i.getMonth()+1,m=i.getFullYear(),u=`${c}.${d}.${m}`,g=`${m}-${d}-${c}`,h=1===s?`${s} view`:`${s} views`,f=1===a?`${a} comment`:`${a} comments`;return`\n                <article class="blog-article">\n                    <div class="blog-article__img">\n                        <picture>\n                            <source srcset="${BASE_URL+n.mobilePhotoUrl} 1x, ${BASE_URL+n.mobile2xPhotoUrl} 2x"\n                                media="(max-width: 767px)">\n                            <source srcset="${BASE_URL+n.tabletPhotoUrl} 1x, ${BASE_URL+n.tablet2xPhotoUrl} 2x"\n                                media="(max-width: 1280px)">\n                            <img src="${BASE_URL+n.desktopPhotoUrl}"\n                                srcset="${BASE_URL+n.desktop2xPhotoUrl} 2x"\n                                width="320"\n                                height="236"\n                                loading="lazy"\n                                decoding="async"\n                                alt="">\n                        </picture>\n                    </div>\n\n                    <div class="blog-article__col">\n                        <div class="blog-article__tags">\n                            ${l}\n                        </div>\n\n                        <div class="blog-article__data">\n                            <time class="blog-article__data-item" datetime="${g}">\n                                ${u}\n                            </time>\n                            <span class="blog-article__data-item">\n                                ${h}\n                            </span>\n                            <span class="blog-article__data-item">\n                                ${f}\n                            </span>\n                        </div>\n\n                        <h3 class="blog-article__title title-h3">\n                            ${e}\n                        </h3>\n\n                        <p class="blog-article__text">\n                            ${t}\n                        </p>\n\n                        <a class="blog-article__link underlined-link underlined-link--black" href="">\n                            Go to this post\n                        </a>\n                    </div>\n                </article>\n            `}(e)}));const i=document.querySelector(".blog-articles__content");i&&(i.innerHTML=a);const c=document.querySelector(".blog-pagination__list");c&&(c.innerHTML=""),function(t,o,r){const a=Math.ceil(o.count/r);for(let e=0;e<a;e++){let o=n(e);t?.insertAdjacentElement("beforeend",o)}!function(t){const[o,r]=s;let a=e();a.page>0&&o?.removeAttribute("disabled");a.page<t-1&&r?.removeAttribute("disabled");0===a.page&&o?.setAttribute("disabled","");a.page!==t-1&&0!==t||r?.setAttribute("disabled","")}(a)}(c,o,l)}else alert(`Ошибка ${t.status}: ${t.statusText}`)},onerror:()=>{toggleLoader(loader),console.error("The data has arrived with error")}})}function n(t){const o=document.createElement("li");o?.classList.add("blog-pagination__item");const s=document.createElement("a");s.href=`?page=${t}`,s.title=`To page ${t+1}`,s.innerText=t+1,s.classList.add("blog-pagination__link","js-paginationLink"),o.append(s);let a=e();return t===Number(a.page)&&s?.classList.add("blog-pagination__link--current"),s?.addEventListener("click",(e=>{e.preventDefault(),r(t)})),o}}();